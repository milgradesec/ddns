version: "3.8"

configs:
  config.json:
    file: config.json

services:
  ddns:
    image: milgradesec/ddns:latest
    configs:
      - source: config.json
        target: /config.json
    secrets:
      - api_token
    environment:
      - CLOUDFLARE_API_TOKEN_FILE=api_token
    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 5

secrets:
  api_token:
    file: API_TOKEN
